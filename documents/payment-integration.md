# Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨
1. [Ù…Ù‚Ø¯Ù…Ù‡](#Ù…Ù‚Ø¯Ù…Ù‡)
2. [Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…](#Ù…Ø¹Ù…Ø§Ø±ÛŒ-Ø³ÛŒØ³ØªÙ…)
3. [Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ](#Ø±Ø§Ù‡-Ø§Ù†Ø¯Ø§Ø²ÛŒ)
4. [Ø¬Ø±ÛŒØ§Ù† Ù¾Ø±Ø¯Ø§Ø®Øª](#Ø¬Ø±ÛŒØ§Ù†-Ù¾Ø±Ø¯Ø§Ø®Øª)
5. [API Endpoints](#api-endpoints)
6. [ØªØ³Øª Sandbox](#ØªØ³Øª-sandbox)
7. [Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§](#Ù…Ø¯ÛŒØ±ÛŒØª-Ø®Ø·Ø§Ù‡Ø§)

---

## ğŸ¯ Ù…Ù‚Ø¯Ù…Ù‡

Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ§Ù… Ø§Ø³Øª Ú©Ù‡ Ø§Ù…Ú©Ø§Ù† Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù‚Ø³Ø§Ø· ÙˆØ§Ù… Ø±Ø§ ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

### ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§
- âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù‚Ø³Ø§Ø· ÙˆØ§Ù…
- âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Sandbox Ø¨Ø±Ø§ÛŒ ØªØ³Øª
- âœ… Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ù¾Ø±Ø¯Ø§Ø®Øª
- âœ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ ÙˆØ§Ù…
- âœ… ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§

---

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…

### Backend (Laravel)

#### 1. Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
- **ZarinpalService** (`app/Services/ZarinpalService.php`)
  - Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ API Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„
  - Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª
  - ØªØ§ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª

#### 2. Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§
- **PaymentController** (`app/Http/Controllers/Api/PaymentController.php`)
  - `initiatePayment()`: Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª
  - `callback()`: Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡
  - `paymentStatus()`: ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
  - `paymentHistory()`: ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§

#### 3. Ù…Ø¯Ù„â€ŒÙ‡Ø§
- **LoanPayment**: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª
- **LoanSchedule**: Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù‚Ø³Ø§Ø·
- **Loan**: Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ§Ù…

### Frontend (React + TypeScript)

#### ØµÙØ­Ø§Øª
- **LoanPayment.tsx**: ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù‚Ø³Ø§Ø·
- **PaymentSuccess.tsx**: ØµÙØ­Ù‡ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
- **PaymentFailed.tsx**: ØµÙØ­Ù‡ Ø´Ú©Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª

#### HookÙ‡Ø§
- **usePayments.ts**: Ù…Ø¯ÛŒØ±ÛŒØª API Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§

---

## ğŸ”§ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### ØªÙ†Ø¸ÛŒÙ…Ø§Øª Backend

#### 1. Ù†ØµØ¨ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§
```bash
cd web-api
composer require zarinpal/zarinpal-php-sdk
```

#### 2. ØªÙ†Ø¸ÛŒÙ…Ø§Øª `.env`
```env
# Zarinpal Configuration
ZARINPAL_MERCHANT_ID=00000000-0000-0000-0000-000000000000
ZARINPAL_SANDBOX=true
ZARINPAL_CALLBACK_URL=http://localhost:8000/api/payment/callback
FRONTEND_URL=http://localhost:5174
```

#### 3. Ø§Ø¬Ø±Ø§ÛŒ Migrations
```bash
php artisan migrate
```

### ØªÙ†Ø¸ÛŒÙ…Ø§Øª Frontend

#### Routeâ€ŒÙ‡Ø§
Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø¯Ø± `App.tsx` Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯:
- `/loan-payment/:id`: ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù‚Ø³Ø§Ø·
- `/payment/success`: ØµÙØ­Ù‡ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
- `/payment/failed`: ØµÙØ­Ù‡ Ø´Ú©Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª

---

## ğŸ”„ Ø¬Ø±ÛŒØ§Ù† Ù¾Ø±Ø¯Ø§Ø®Øª

### 1. Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª

**Frontend:**
```typescript
// Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ù¾Ø±Ø¯Ø§Ø®Øª" Ú©Ù„ÛŒÚ© Ù…ÛŒâ€ŒÚ©Ù†Ø¯
const handlePayment = (scheduleId: number) => {
  initiatePayment.mutate({ 
    loanId: loan.id, 
    scheduleId 
  });
};
```

**Backend:**
```php
// POST /api/payment/loans/{loan}/initiate
POST body: {
  "schedule_id": 1,
  "amount": 500000  // Ø§Ø®ØªÛŒØ§Ø±ÛŒØŒ Ø§Ú¯Ø± Ù†Ø¨Ø§Ø´Ø¯ Ù…Ø¨Ù„Øº Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
}
```

### 2. Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡

Ø¨Ø¹Ø¯ Ø§Ø² Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆÙÙ‚ØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ redirect Ù…ÛŒâ€ŒØ´ÙˆØ¯:
```
https://sandbox.zarinpal.com/pg/StartPay/{authority}
```

### 3. Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Sandbox

**Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Øª ØªØ³Øª:**
- Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª: `6037991234567890`
- CVV2: Ù‡Ø± Ø¹Ø¯Ø¯ Û³ Ø±Ù‚Ù…ÛŒ
- ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§Ø¡: Ù‡Ø± ØªØ§Ø±ÛŒØ® Ø¢ÛŒÙ†Ø¯Ù‡
- Ú©Ù„Ù…Ù‡ Ø¹Ø¨ÙˆØ±: Ù‡Ø± Ø¹Ø¯Ø¯ Û´ Ø±Ù‚Ù…ÛŒ

### 4. Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡

Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®ØªØŒ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ Ø¨Ù‡ URL Ø²ÛŒØ± redirect Ù…ÛŒâ€ŒÚ©Ù†Ø¯:
```
GET http://localhost:8000/api/payment/callback?Authority=...&Status=OK
```

### 5. ØªØ§ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª

Backend Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯:
1. Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø¨Ø§ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ verify Ù…ÛŒâ€ŒÚ©Ù†Ø¯
2. ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø¨Ù‡ `completed` ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
3. `paid_amount` Ø¯Ø± schedule Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
4. ÙˆØ¶Ø¹ÛŒØª schedule Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (`paid`, `partial`, `pending`)
5. `remaining_balance` ÙˆØ§Ù… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
6. Ø§Ú¯Ø± ØªÙ…Ø§Ù… ÙˆØ§Ù… Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡ØŒ ÙˆØ¶Ø¹ÛŒØª ÙˆØ§Ù… Ø±Ø§ Ø¨Ù‡ `paid` ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯

### 6. Redirect Ø¨Ù‡ Frontend

Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ÛŒÚ©ÛŒ Ø§Ø² ØµÙØ­Ø§Øª Ø²ÛŒØ± redirect Ù…ÛŒâ€ŒØ´ÙˆØ¯:

**Ù…ÙˆÙÙ‚:**
```
http://localhost:5174/payment/success?payment_id=7
```

**Ø®Ø·Ø§:**
```
http://localhost:5174/payment/failed?payment_id=7&error=...
```

---

## ğŸ“¡ API Endpoints

### 1. Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª
```
POST /api/payment/loans/{loan}/initiate
Authorization: Bearer {token}

Body:
{
  "schedule_id": 1,
  "amount": 500000  // Ø§Ø®ØªÛŒØ§Ø±ÛŒ
}

Response:
{
  "success": true,
  "payment_url": "https://sandbox.zarinpal.com/...",
  "authority": "S000...",
  "payment_id": 7
}
```

### 2. Callback Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡
```
GET|POST /api/payment/callback?Authority=...&Status=OK
Redirect: /payment/success?payment_id={id}
```

### 3. ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
```
GET /api/payment/status/{paymentId}
Authorization: Bearer {token}

Response:
{
  "success": true,
  "payment": {
    "id": 7,
    "status": "completed",
    "amount": 500000,
    "created_at": "2025-10-26T..."
  }
}
```

### 4. ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§
```
GET /api/payment/history
Authorization: Bearer {token}

Response:
{
  "success": true,
  "payments": [...]
}
```

---

## ğŸ§ª ØªØ³Øª Sandbox

### Ù…Ø±Ø§Ø­Ù„ ØªØ³Øª

1. **ÛŒÚ© ÙˆØ§Ù… Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯** (Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª `approved`)
2. **Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø±ÙˆÛŒØ¯**: `/loan-payment/{loan_id}`
3. **Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ù¾Ø±Ø¯Ø§Ø®Øª" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯**
4. **Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯**
5. **Ø¨Ø§ Ú©Ø§Ø±Øª ØªØ³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯**:
   - Card: `6037991234567890`
   - CVV2: `123`
   - Expiry: `12/25`
   - Password: `1234`
6. **Ù¾Ø³ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ØŒ Ø¨Ù‡ ØµÙØ­Ù‡ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯**

### Ø¨Ø±Ø±Ø³ÛŒ Ù†ØªÛŒØ¬Ù‡

1. **Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª**: ÙˆØ¶Ø¹ÛŒØª Ù‚Ø³Ø· Ø¨Ù‡ `paid` ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
2. **Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ ÙˆØ§Ù…**: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
3. **ØªØ§Ø±ÛŒØ®Ú†Ù‡**: Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯

---

## âš ï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§

### Ú©Ø¯Ù‡Ø§ÛŒ Ø®Ø·Ø§

| Ú©Ø¯ | Ù…Ø¹Ù†Ø§ | Ø±Ø§Ù‡Ú©Ø§Ø± |
|----|------|--------|
| 100 | Ù…ÙˆÙÙ‚ | - |
| 101 | Ù¾Ø±Ø¯Ø§Ø®Øª Ù‚Ø¨Ù„Ø§Ù‹ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ | Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù…ÙˆÙÙ‚ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ |
| -9 | Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± | Ø¨Ø±Ø±Ø³ÛŒ authority Ùˆ amount |
| -11 | Merchant ID Ù†Ø§Ù…Ø¹ØªØ¨Ø± | Ø¨Ø±Ø±Ø³ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª |
| -21 | Authority Ù†Ø§Ù…Ø¹ØªØ¨Ø± | - |

### Ù„Ø§Ú¯â€ŒÙ‡Ø§

Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„ Ø¯Ø± `storage/logs/laravel.log` Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯:

```
[2025-10-26 14:29:24] local.INFO: Payment callback received {"authority":"...","status":"OK"}
[2025-10-26 14:29:25] local.INFO: Verifying payment {"payment_id":7,"has_schedule":true,"has_loan":true}
[2025-10-26 14:29:26] local.INFO: Schedule updated {"schedule_id":1,"paid_amount":505850,"status":"paid"}
[2025-10-26 14:29:26] local.INFO: Loan updated {"loan_id":15,"remaining_balance":0,"status":"paid"}
```

---

## ğŸ” Ø§Ù…Ù†ÛŒØª

### Best Practices

1. **HTTPS**: Ø¯Ø± production Ø­ØªÙ…Ø§Ù‹ Ø§Ø² HTTPS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
2. **Authorization**: Ù‡Ù…Ù‡ endpointâ€ŒÙ‡Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ authentication Ø¯Ø§Ø±Ù†Ø¯
3. **Validation**: Ù‡Ù…Ù‡ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ validate Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
4. **Transaction**: Ø§Ø² Transaction Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø¨Ø±Ø§ÛŒ ensure consistency
5. **Logging**: Ù‡Ù…Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª Ù„Ø§Ú¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯

### Merchant ID

- **Sandbox**: `00000000-0000-0000-0000-000000000000`
- **Production**: Ø¨Ø§ÛŒØ¯ Ø§Ø² Ù¾Ù†Ù„ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯

---

## ğŸ“Š ÙÙ„ÙˆÚ†Ø§Ø±Øª Ù¾Ø±Ø¯Ø§Ø®Øª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ú©Ø§Ø±Ø¨Ø±   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Ø±ÙˆÛŒ "Ù¾Ø±Ø¯Ø§Ø®Øª" Ú©Ù„ÛŒÚ© Ù…ÛŒâ€ŒÚ©Ù†Ø¯
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ initiatePayment API     â”‚
â”‚ - Payment record Ø§ÛŒØ¬Ø§Ø¯  â”‚
â”‚ - Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ redirect
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø¯Ø±Ú¯Ø§Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ (Sandbox)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Ú©Ø§Ø±Ø¨Ø± Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Callback API            â”‚
â”‚ - Verify payment         â”‚
â”‚ - Update schedule        â”‚
â”‚ - Update loan            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼ redirect
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend - Success Page â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Frontend Components

### LoanPayment.tsx
ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù‡ Ø´Ø§Ù…Ù„:
- Ù„ÛŒØ³Øª Ø§Ù‚Ø³Ø§Ø· Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª
- Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ§Ù…
- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù‚Ø³Ø·

### PaymentSuccess.tsx
Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚:
- Ø´Ù†Ø§Ø³Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª
- Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡
- Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª

### PaymentFailed.tsx
Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ Ø¯Ø± ØµÙˆØ±Øª Ø´Ú©Ø³Øª:
- Ù¾ÛŒØ§Ù… Ø®Ø·Ø§
- Ø¯Ú©Ù…Ù‡ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯

---

## ğŸ› Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ù…Ø´Ú©Ù„: Redirect Ø¨Ù‡ Ù¾ÙˆØ±Øª Ø§Ø´ØªØ¨Ø§Ù‡

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
```bash
# .env Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
FRONTEND_URL=http://localhost:5174

# Cache Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯
php artisan config:clear
php artisan cache:clear

# Ø³Ø±ÙˆØ± Ø±Ø§ restart Ú©Ù†ÛŒØ¯
```

### Ù…Ø´Ú©Ù„: ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
2. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ schedule Ùˆ loan Ù…ÙˆØ¬ÙˆØ¯Ù†Ø¯
3. Transaction Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯

### Ù…Ø´Ú©Ù„: Ú©Ø¯ 101

Ø§ÛŒÙ† ÛŒØ¹Ù†ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‚Ø¨Ù„Ø§Ù‹ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡. Ø³ÛŒØ³ØªÙ… Ø§ÛŒÙ† Ø±Ø§ ØªØ´Ø®ÛŒØµ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

---

## ğŸ“ Ú©Ø¯Ù‡Ø§ÛŒ Ù…Ù‡Ù…

### ZarinpalService

```php
public function requestPayment(int $amount, string $description, ...): array
{
    // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„
}

public function verifyPayment(string $authority, int $amount): array
{
    // ØªØ§ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª
}
```

### PaymentController

```php
public function initiatePayment(Request $request, Loan $loan): JsonResponse
{
    // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ redirect Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡
}

public function callback(Request $request)
{
    // Ø¯Ø±ÛŒØ§ÙØª callback Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´
}
```

---

## ğŸš€ Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Production

Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Production:

1. `ZARINPAL_SANDBOX=false` Ú©Ù†ÛŒØ¯
2. `ZARINPAL_MERCHANT_ID` ÙˆØ§Ù‚Ø¹ÛŒ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯
3. HTTPS Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯
4. Ø¯Ø§Ù…Ù†Ù‡ production Ø±Ø§ Ø¯Ø± callback URL Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯

---

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¯Ø± ØµÙˆØ±Øª Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ù…Ø´Ú©Ù„ ÛŒØ§ Ø³ÙˆØ§Ù„:
1. Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯: `storage/logs/laravel.log`
2. Ù…Ø±Ø¬Ø¹ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„: https://doc.zarinpal.com
3. ØªØ³Øª Sandbox: Ù‡Ù…ÛŒØ´Ù‡ Ù‚Ø¨Ù„ Ø§Ø² production ØªØ³Øª Ú©Ù†ÛŒØ¯

---

**Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ**: 26 Ø§Ú©ØªØ¨Ø± 2025

